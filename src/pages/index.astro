---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Badge from '../components/Badge.astro';
import { SITE_TITLE } from '../consts';
import BlogPost from '../components/BlogPost.astro';

const posts = await getCollection('posts');
const tags = [...new Set(posts.flatMap((post) => post.data.tags || []))];
const sortedPosts = posts.toSorted((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout>
	<main class="max-w-screen-md mx-auto">
		<div class="flex flex-col md:flex-row gap-8 items-center">
			<img
				src="/img/david-soards.jpg"
				alt="David Soards"
				class="self-start md:self-auto rounded-full size-20"
			/>
			<div>
				<h1 class="text-3xl mt-0">{SITE_TITLE}</h1>
				<p class="text-lg mb-0">
					A blog by me, David Soards, mostly about Front-End Development and UI Design.
				</p>
			</div>
		</div>
		<div>
			<!-- TODO filter theset to top 10 tags -->
			<ul class="mb-16 mt-8 flex flex-wrap gap-2">
				{
					tags.map((tag) => {
						return (
							<li>
								<a href={`/tags/${tag}`}>
									<Badge textSize="text-base">{tag}</Badge>
								</a>
							</li>
						);
					})
				}
			</ul>
		</div>
		<section>
			<ul class="grid gap-8 md:gap-8">
				{sortedPosts.map((post) => <BlogPost post={post} />)}
			</ul>
		</section>
	</main>
</BaseLayout>
